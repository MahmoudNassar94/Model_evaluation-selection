{"cells":[{"cell_type":"markdown","id":"5ea66c60","metadata":{"id":"5ea66c60"},"source":["# Model Selection & Evaluation"]},{"cell_type":"markdown","id":"ad633d3a","metadata":{"id":"ad633d3a"},"source":["### Importing Libraries"]},{"cell_type":"code","execution_count":null,"id":"6e7c83e8","metadata":{"id":"6e7c83e8"},"outputs":[],"source":["import numpy as np\n","import pandas as pd\n","import matplotlib.pyplot as plt\n","import seaborn as sns\n","%matplotlib inline\n","sns.set()"]},{"cell_type":"code","execution_count":null,"id":"9b033498","metadata":{"id":"9b033498"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"a1320211","metadata":{"id":"a1320211"},"source":["=========="]},{"cell_type":"markdown","id":"4a2ad5af","metadata":{"id":"4a2ad5af"},"source":["# Model Selection"]},{"cell_type":"code","execution_count":null,"id":"e312bac0","metadata":{"id":"e312bac0"},"outputs":[],"source":["from sklearn.datasets import load_iris"]},{"cell_type":"code","execution_count":null,"id":"11d671d8","metadata":{"id":"11d671d8"},"outputs":[],"source":["iris = load_iris()"]},{"cell_type":"code","execution_count":null,"id":"d837a1c7","metadata":{"id":"d837a1c7"},"outputs":[],"source":["print(iris.keys())"]},{"cell_type":"code","execution_count":null,"id":"3e3a30b4","metadata":{"id":"3e3a30b4"},"outputs":[],"source":["print(iris.DESCR)"]},{"cell_type":"code","execution_count":null,"id":"7bc8e55c","metadata":{"id":"7bc8e55c"},"outputs":[],"source":["X = iris.data\n","X"]},{"cell_type":"code","execution_count":null,"id":"d633a2e1","metadata":{"id":"d633a2e1"},"outputs":[],"source":["y = iris.target\n","y"]},{"cell_type":"code","execution_count":null,"id":"11f02fdf","metadata":{"id":"11f02fdf"},"outputs":[],"source":["iris_df = pd.DataFrame(X, columns=iris.feature_names)\n","iris_df"]},{"cell_type":"code","execution_count":null,"id":"b279796f","metadata":{"id":"b279796f"},"outputs":[],"source":["iris_df['target'] = iris.target"]},{"cell_type":"code","execution_count":null,"id":"d194a93c","metadata":{"id":"d194a93c"},"outputs":[],"source":["iris_df"]},{"cell_type":"code","execution_count":null,"id":"b46f9efd","metadata":{"id":"b46f9efd"},"outputs":[],"source":["X = iris_df.drop('target', axis=1).values\n","X"]},{"cell_type":"code","execution_count":null,"id":"3d4f76f8","metadata":{"id":"3d4f76f8"},"outputs":[],"source":["y = iris_df['target'].values\n","y"]},{"cell_type":"code","execution_count":null,"id":"85cd0356","metadata":{"id":"85cd0356"},"outputs":[],"source":["from sklearn.model_selection import train_test_split"]},{"cell_type":"code","execution_count":null,"id":"94b46ecc","metadata":{"id":"94b46ecc"},"outputs":[],"source":["X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)"]},{"cell_type":"code","execution_count":null,"id":"da7ae87c","metadata":{"id":"da7ae87c"},"outputs":[],"source":["# SVC -> Model # 1\n","from sklearn.svm import SVC\n","clf = SVC(C=10, kernel='poly', degree=3)\n","clf.fit(X_train, y_train)\n","y_pred = clf.predict(X_test)\n","\n","# Evaluation\n","from sklearn.metrics import accuracy_score\n","print(accuracy_score(y_test, y_pred))\n","print()\n","from sklearn.metrics import confusion_matrix\n","print(confusion_matrix(y_test, y_pred))"]},{"cell_type":"code","execution_count":null,"id":"11bf42b0","metadata":{"id":"11bf42b0"},"outputs":[],"source":["# KNN -> Model # 2\n","from sklearn.neighbors import KNeighborsClassifier\n","clf = KNeighborsClassifier()\n","clf.fit(X_train, y_train)\n","y_pred = clf.predict(X_test)\n","\n","# Evaluation\n","from sklearn.metrics import accuracy_score\n","print(accuracy_score(y_test, y_pred))\n","print()\n","from sklearn.metrics import confusion_matrix\n","print(confusion_matrix(y_test, y_pred))"]},{"cell_type":"code","execution_count":null,"id":"01f73f2a","metadata":{"id":"01f73f2a"},"outputs":[],"source":["# Logistic Regression -> Model # 3\n","from sklearn.linear_model import LogisticRegression\n","clf = LogisticRegression(max_iter=10000)\n","clf.fit(X_train, y_train)\n","y_pred = clf.predict(X_test)\n","\n","# Evaluation\n","from sklearn.metrics import accuracy_score\n","print(accuracy_score(y_test, y_pred))\n","print()\n","from sklearn.metrics import confusion_matrix\n","print(confusion_matrix(y_test, y_pred))"]},{"cell_type":"code","execution_count":null,"id":"a87f15a9","metadata":{"id":"a87f15a9"},"outputs":[],"source":["# Random Forests -> Model # 4\n","from sklearn.ensemble import RandomForestClassifier\n","clf = RandomForestClassifier(n_estimators=150, max_depth=10, max_leaf_nodes=5)\n","clf.fit(X_train, y_train)\n","y_pred = clf.predict(X_test)\n","\n","# Evaluation\n","from sklearn.metrics import accuracy_score\n","print(accuracy_score(y_test, y_pred))\n","print()\n","from sklearn.metrics import confusion_matrix\n","print(confusion_matrix(y_test, y_pred))"]},{"cell_type":"code","execution_count":null,"id":"0ab23979","metadata":{"id":"0ab23979"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"5c285603","metadata":{"id":"5c285603"},"source":["=========="]},{"cell_type":"markdown","id":"ad3f56af","metadata":{"id":"ad3f56af"},"source":["# Model Evaluation & Improvement"]},{"cell_type":"markdown","id":"39b628b0","metadata":{"id":"39b628b0"},"source":["## Splitter (Cross-Validation)"]},{"cell_type":"markdown","id":"551b87ca","metadata":{"id":"551b87ca"},"source":["##### Importing Dataset"]},{"cell_type":"code","execution_count":null,"id":"f52c1809","metadata":{"id":"f52c1809"},"outputs":[],"source":["from sklearn.datasets import load_breast_cancer"]},{"cell_type":"code","execution_count":null,"id":"a905472e","metadata":{"id":"a905472e"},"outputs":[],"source":["cancer = load_breast_cancer()"]},{"cell_type":"markdown","id":"486ba898","metadata":{"id":"486ba898"},"source":["##### Selecting Model"]},{"cell_type":"code","execution_count":null,"id":"92f8db6a","metadata":{"id":"92f8db6a"},"outputs":[],"source":["from sklearn.svm import SVC"]},{"cell_type":"code","execution_count":null,"id":"85acc3fb","metadata":{"id":"85acc3fb"},"outputs":[],"source":["clf = SVC()"]},{"cell_type":"code","execution_count":null,"id":"a0880c46","metadata":{"id":"a0880c46"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"1db45339","metadata":{"id":"1db45339"},"source":["### Cross-Validation with `train_test_split`"]},{"cell_type":"markdown","id":"c5728d37","metadata":{"id":"c5728d37"},"source":["https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html"]},{"cell_type":"code","execution_count":null,"id":"1ea69025","metadata":{"id":"1ea69025"},"outputs":[],"source":["X = cancer.data\n","y = cancer.target"]},{"cell_type":"code","execution_count":null,"id":"b5bce4f0","metadata":{"id":"b5bce4f0"},"outputs":[],"source":["from sklearn.model_selection import train_test_split"]},{"cell_type":"code","execution_count":null,"id":"926e7e64","metadata":{"id":"926e7e64"},"outputs":[],"source":["# X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)"]},{"cell_type":"code","execution_count":null,"id":"b4d01f64","metadata":{"id":"b4d01f64"},"outputs":[],"source":["X_train, X_temp, y_train, y_temp = train_test_split(X, y, test_size=0.2, random_state=42)"]},{"cell_type":"code","execution_count":null,"id":"d2daab7d","metadata":{"id":"d2daab7d"},"outputs":[],"source":["X_valid, X_test, y_valid, y_test = train_test_split(X_temp, y_temp, test_size=0.5, random_state=42)"]},{"cell_type":"code","execution_count":null,"id":"67326d3d","metadata":{"id":"67326d3d"},"outputs":[],"source":["X.shape"]},{"cell_type":"code","execution_count":null,"id":"017c1045","metadata":{"id":"017c1045"},"outputs":[],"source":["X_train.shape"]},{"cell_type":"code","execution_count":null,"id":"44b31183","metadata":{"id":"44b31183"},"outputs":[],"source":["X_valid.shape"]},{"cell_type":"code","execution_count":null,"id":"9a7b99a7","metadata":{"id":"9a7b99a7"},"outputs":[],"source":["X_test.shape"]},{"cell_type":"code","execution_count":null,"id":"9c512122","metadata":{"id":"9c512122"},"outputs":[],"source":["# training (class)\n","clf.fit(X_train, y_train)"]},{"cell_type":"markdown","id":"67667349","metadata":{"id":"67667349"},"source":["##### Evaluating Model"]},{"cell_type":"code","execution_count":null,"id":"d4e67f5e","metadata":{"id":"d4e67f5e"},"outputs":[],"source":["from sklearn.metrics import accuracy_score"]},{"cell_type":"code","execution_count":null,"id":"bafb17a0","metadata":{"id":"bafb17a0"},"outputs":[],"source":["# validation (midterm)\n","y_pred_valid = clf.predict(X_valid)\n","y_pred_valid"]},{"cell_type":"code","execution_count":null,"id":"eadcba81","metadata":{"id":"eadcba81"},"outputs":[],"source":["y_valid"]},{"cell_type":"code","execution_count":null,"id":"1bae4ea0","metadata":{"id":"1bae4ea0"},"outputs":[],"source":["print(accuracy_score(y_valid, y_pred_valid))"]},{"cell_type":"code","execution_count":null,"id":"3e696e17","metadata":{"id":"3e696e17"},"outputs":[],"source":["# testing (final)\n","y_pred_test = clf.predict(X_test)\n","y_pred_test"]},{"cell_type":"code","execution_count":null,"id":"f2a37995","metadata":{"id":"f2a37995"},"outputs":[],"source":["y_test"]},{"cell_type":"code","execution_count":null,"id":"7d9f1878","metadata":{"id":"7d9f1878"},"outputs":[],"source":["print(accuracy_score(y_test, y_pred_test))"]},{"cell_type":"code","execution_count":null,"id":"dfc7e3e6","metadata":{"id":"dfc7e3e6"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"97c53b1d","metadata":{"id":"97c53b1d"},"source":["### Cross-Validation with `cross_val_score`"]},{"cell_type":"markdown","id":"958d5c67","metadata":{"id":"958d5c67"},"source":["https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_score.html"]},{"cell_type":"code","execution_count":null,"id":"9841fe89","metadata":{"id":"9841fe89"},"outputs":[],"source":["from sklearn.model_selection import cross_val_score"]},{"cell_type":"code","execution_count":null,"id":"5c969c43","metadata":{"id":"5c969c43"},"outputs":[],"source":["X_train, X_test, y_train, y_test = train_test_split(cancer.data, cancer.target, test_size=0.1, random_state=42)"]},{"cell_type":"code","execution_count":null,"id":"e72a6110","metadata":{"id":"e72a6110"},"outputs":[],"source":["scores = cross_val_score(clf, X_train, y_train)\n","scores"]},{"cell_type":"code","execution_count":null,"id":"fa98f591","metadata":{"id":"fa98f591"},"outputs":[],"source":["scores = cross_val_score(clf, cancer.data, cancer.target, cv=3)\n","scores"]},{"cell_type":"code","execution_count":null,"id":"ac20d0dd","metadata":{"id":"ac20d0dd"},"outputs":[],"source":["scores.mean()"]},{"cell_type":"code","execution_count":null,"id":"f7229468","metadata":{"id":"f7229468"},"outputs":[],"source":["# clf.score(y_test, clf.predict(X_test))"]},{"cell_type":"code","execution_count":null,"id":"8a04a240","metadata":{"id":"8a04a240"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"4afa492f","metadata":{"id":"4afa492f"},"source":["### Cross-Validation with `cross_validate`"]},{"cell_type":"markdown","id":"45ca8269","metadata":{"id":"45ca8269"},"source":["https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_validate.html"]},{"cell_type":"code","execution_count":null,"id":"8dd66a78","metadata":{"id":"8dd66a78"},"outputs":[],"source":["from sklearn.model_selection import cross_validate"]},{"cell_type":"markdown","id":"8d9b67f6","metadata":{"id":"8d9b67f6"},"source":["Scoring Options: https://scikit-learn.org/stable/modules/model_evaluation.html"]},{"cell_type":"code","execution_count":null,"id":"48446f1c","metadata":{"scrolled":false,"id":"48446f1c"},"outputs":[],"source":["scores = cross_validate(clf, X, y, scoring=['accuracy','average_precision'],cv=10)\n","scores"]},{"cell_type":"code","execution_count":null,"id":"52f1f597","metadata":{"id":"52f1f597"},"outputs":[],"source":["pd.DataFrame(scores)#['test_score']"]},{"cell_type":"code","execution_count":null,"id":"b1f4cd9d","metadata":{"id":"b1f4cd9d"},"outputs":[],"source":["pd.DataFrame(scores)['test_accuracy'].mean()"]},{"cell_type":"code","execution_count":null,"id":"00a57b07","metadata":{"id":"00a57b07"},"outputs":[],"source":["pd.DataFrame(scores)['test_average_precision'].mean()"]},{"cell_type":"code","execution_count":null,"id":"dadea20c","metadata":{"id":"dadea20c"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"c9533ba8","metadata":{"id":"c9533ba8"},"source":["=========="]},{"cell_type":"markdown","id":"19c6200c","metadata":{"id":"19c6200c"},"source":["## Hyperparameters Tuning (Grid Search)"]},{"cell_type":"markdown","id":"3ae14f48","metadata":{"id":"3ae14f48"},"source":["https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html"]},{"cell_type":"code","execution_count":null,"id":"081b6d7f","metadata":{"id":"081b6d7f"},"outputs":[],"source":["from sklearn.model_selection import GridSearchCV"]},{"cell_type":"code","execution_count":null,"id":"f2e1a524","metadata":{"id":"f2e1a524"},"outputs":[],"source":["param_grid = {'C': [0.001, 0.01, 0.1, 1, 10, 100],\n","              'gamma': [0.001, 0.01, 0.1, 1, 10, 100]}\n","param_grid"]},{"cell_type":"code","execution_count":null,"id":"70875eda","metadata":{"id":"70875eda"},"outputs":[],"source":["from sklearn.svm import SVC"]},{"cell_type":"code","execution_count":null,"id":"aacd8f4f","metadata":{"id":"aacd8f4f"},"outputs":[],"source":["grid_search = GridSearchCV(SVC(), param_grid, cv=5)"]},{"cell_type":"code","execution_count":null,"id":"6f2583c5","metadata":{"id":"6f2583c5"},"outputs":[],"source":["X_train, X_test, y_train, y_test = train_test_split(cancer.data, cancer.target, random_state=42)"]},{"cell_type":"code","execution_count":null,"id":"93e003ff","metadata":{"id":"93e003ff"},"outputs":[],"source":["grid_search.fit(X_train, y_train)"]},{"cell_type":"code","execution_count":null,"id":"fc5710ad","metadata":{"id":"fc5710ad"},"outputs":[],"source":["grid_search.score(X_test, y_test)"]},{"cell_type":"code","execution_count":null,"id":"6788a1f6","metadata":{"id":"6788a1f6"},"outputs":[],"source":["grid_search.best_params_"]},{"cell_type":"code","execution_count":null,"id":"4eb50c2e","metadata":{"id":"4eb50c2e"},"outputs":[],"source":["grid_search.best_score_"]},{"cell_type":"code","execution_count":null,"id":"616847cd","metadata":{"id":"616847cd"},"outputs":[],"source":["grid_search.best_estimator_"]},{"cell_type":"code","execution_count":null,"id":"b5a29c67","metadata":{"scrolled":true,"id":"b5a29c67"},"outputs":[],"source":["pd.DataFrame(grid_search.cv_results_)"]},{"cell_type":"code","execution_count":null,"id":"193d5fc4","metadata":{"id":"193d5fc4"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"98827423","metadata":{"id":"98827423"},"source":["=========="]},{"cell_type":"markdown","id":"e00324db","metadata":{"id":"e00324db"},"source":["# Algorithms Chain & Pipeline"]},{"cell_type":"markdown","id":"a7909f44","metadata":{"id":"a7909f44"},"source":["### Traditional Pipeline"]},{"cell_type":"code","execution_count":null,"id":"08696c48","metadata":{"id":"08696c48"},"outputs":[],"source":["# loading data\n","from sklearn.datasets import load_breast_cancer\n","cancer = load_breast_cancer()"]},{"cell_type":"code","execution_count":null,"id":"641f1c6c","metadata":{"id":"641f1c6c"},"outputs":[],"source":["# splitting data\n","from sklearn.model_selection import train_test_split\n","X_train, X_test, y_train, y_test = train_test_split(cancer.data, cancer.target, random_state=0)"]},{"cell_type":"code","execution_count":null,"id":"a97703c3","metadata":{"id":"a97703c3"},"outputs":[],"source":["# scaling data\n","from sklearn.preprocessing import MinMaxScaler\n","scaler = MinMaxScaler().fit(X_train)\n","X_train_scaled = scaler.transform(X_train)"]},{"cell_type":"code","execution_count":null,"id":"c24f994e","metadata":{"id":"c24f994e"},"outputs":[],"source":["# building model\n","from sklearn.svm import SVC\n","svm = SVC()"]},{"cell_type":"code","execution_count":null,"id":"9131ada7","metadata":{"id":"9131ada7"},"outputs":[],"source":["# learn an SVM on the scaled training data\n","svm.fit(X_train_scaled, y_train)"]},{"cell_type":"code","execution_count":null,"id":"3308093a","metadata":{"id":"3308093a"},"outputs":[],"source":["# scale the test data and score the scaled data\n","X_test_scaled = scaler.transform(X_test)"]},{"cell_type":"code","execution_count":null,"id":"679ca589","metadata":{"id":"679ca589"},"outputs":[],"source":["svm.score(X_test_scaled, y_test)"]},{"cell_type":"code","execution_count":null,"id":"b63ab237","metadata":{"id":"b63ab237"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"808f64c9","metadata":{"id":"808f64c9"},"source":["### Building Pipeline"]},{"cell_type":"markdown","id":"3a60cdde","metadata":{"id":"3a60cdde"},"source":["https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html"]},{"cell_type":"code","execution_count":null,"id":"7131aaaf","metadata":{"id":"7131aaaf"},"outputs":[],"source":["from sklearn.pipeline import Pipeline"]},{"cell_type":"code","execution_count":null,"id":"09081f00","metadata":{"id":"09081f00"},"outputs":[],"source":["pipe = Pipeline([(\"scaler\", MinMaxScaler()), (\"svm\", SVC())])"]},{"cell_type":"code","execution_count":null,"id":"59066d5f","metadata":{"id":"59066d5f"},"outputs":[],"source":["pipe.fit(X_train, y_train)"]},{"cell_type":"code","execution_count":null,"id":"ec1ed224","metadata":{"id":"ec1ed224"},"outputs":[],"source":["pipe.score(X_test, y_test)"]},{"cell_type":"code","execution_count":null,"id":"e9377169","metadata":{"id":"e9377169"},"outputs":[],"source":[]},{"cell_type":"markdown","id":"dc36fe59","metadata":{"id":"dc36fe59"},"source":["### Using Pipelines in Grid Searches"]},{"cell_type":"code","execution_count":null,"id":"ef538f1e","metadata":{"id":"ef538f1e"},"outputs":[],"source":["param_grid = {'svm__C': [0.001, 0.01, 0.1, 1, 10, 100],\n","              'svm__gamma': [0.001, 0.01, 0.1, 1, 10, 100]}"]},{"cell_type":"code","execution_count":null,"id":"5c27cee1","metadata":{"id":"5c27cee1"},"outputs":[],"source":["grid = GridSearchCV(pipe, param_grid=param_grid, cv=5)"]},{"cell_type":"code","execution_count":null,"id":"f40f833c","metadata":{"id":"f40f833c"},"outputs":[],"source":["grid.fit(X_train, y_train)"]},{"cell_type":"code","execution_count":null,"id":"2fff065f","metadata":{"id":"2fff065f"},"outputs":[],"source":["grid.best_score_"]},{"cell_type":"code","execution_count":null,"id":"64d4967e","metadata":{"id":"64d4967e"},"outputs":[],"source":["grid.score(X_test, y_test)"]},{"cell_type":"code","execution_count":null,"id":"02d66066","metadata":{"id":"02d66066"},"outputs":[],"source":["grid.best_params_"]},{"cell_type":"code","execution_count":null,"id":"20470b49","metadata":{"id":"20470b49"},"outputs":[],"source":[]}],"metadata":{"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.8"},"colab":{"provenance":[]}},"nbformat":4,"nbformat_minor":5}